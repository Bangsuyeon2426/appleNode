<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ejsíŒŒì¼(list)</title>
    <link rel="stylesheet" href="/main.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> -->
</head>
<!-- ejsíŒŒì¼ ì•ˆì—ì„œëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• ì–´ë””ì„œë‚˜ ì‚¬ìš©ê°€ëŠ¥!!! -->
<!-- html ì•ˆì— jsë¬¸ë²• ì“°ë ¤ë©´ <% %> ì•ˆì— ì“´ë‹¤ -->

<body class="grey-bg">
    <!-- include() ì“°ë©´ ë‹¤ë¥¸ ejs íŒŒì¼ì— ìˆë˜ html ë³µì‚¬í•´ì˜¬ ìˆ˜ ìˆìŒ -->
    <!-- ë³€ìˆ˜ë„ ë„£ê¸° ê°€ëŠ¥ -->
    <%- include('nav.ejs') %>

        <input class="search">
        <button class="search-send">ê²€ìƒ‰</button>
        <script>
            document.querySelector('.search-send').addEventListener('click', function () {
                let ì…ë ¥í•œê±° = document.querySelector('.search').value;
                //query stringë¡œ ì „ì†¡
                location.href = '/search?val=' + ì…ë ¥í•œê±°;
            })
        </script>

        <h4>ê²€ìƒ‰ê²°ê³¼</h4>

        <div class="white-bg">
            <% if (ê¸€ëª©ë¡ && ê¸€ëª©ë¡.length>0) { %>
                <%for(let i=0;i<ê¸€ëª©ë¡.length;i++){%>
                    <div class="list-box">
                        <h4>
                            <a href="/detail/<%=ê¸€ëª©ë¡[i]._id%>">
                                <%=ê¸€ëª©ë¡[i].title%>
                            </a>
                            <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                            <!-- ë°ì´í„° ìˆ¨ê²¨ë†“ëŠ” ë²•=>ì‰½ê²Œ êº¼ë‚´ì“°ê¸° ê°€ëŠ¥ -->
                            <span class="delete" data-id="<%=ê¸€ëª©ë¡[i]._id%>">ğŸ—‘ï¸</span>
                        </h4>
                        <p>
                            <%=ê¸€ëª©ë¡[i].content%>
                        </p>
                    </div>
                    <%}%>
                        <% } else { %>
                            <p>ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <% } %>
        </div>

        <!-- axios -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // ê¸€ëª©ë¡ì´ ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ëœ ê²½ìš°ì—ë§Œ ì‚­ì œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡

                if (ê¸€ëª©ë¡ && Array.isArray(ê¸€ëª©ë¡)) {
                    for (let i = 0; i < '<%=ê¸€ëª©ë¡.length%>'; i++) {
                        // ì‚­ì œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                        document.querySelectorAll('.delete')[i].addEventListener('click', function (e) {
                            // ì‚­ì œ ìš”ì²­ì„ ì„œë²„ë¡œ ì „ì†¡
                            fetch('/delete?docid=' + e.target.dataset.id, {
                                method: 'DELETE'
                            })
                                .then((r) => r.text())  // array.obj => .json()
                                .then((r) => {
                                    // ì„±ê³µì ìœ¼ë¡œ ì‚­ì œëœ ê²½ìš° í•´ë‹¹ ìš”ì†Œë¥¼ ìˆ¨ê¹€
                                    e.target.parentElement.parentElement.style.display = 'none';
                                })
                                .catch((error) => {
                                    console.error('Error deleting:', error);
                                });
                        });
                    }
                }

            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
</body>

</html>