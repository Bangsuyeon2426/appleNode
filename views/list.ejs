<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ejsíŒŒì¼(list)</title>
    <link rel="stylesheet" href="/main.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"> -->
</head>
<!-- ejsíŒŒì¼ ì•ˆì—ì„œëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• ì–´ë””ì„œë‚˜ ì‚¬ìš©ê°€ëŠ¥!!! -->
<!-- html ì•ˆì— jsë¬¸ë²• ì“°ë ¤ë©´ <% %> ì•ˆì— ì“´ë‹¤ -->

<body class="grey-bg">
    <!-- include() ì“°ë©´ ë‹¤ë¥¸ ejs íŒŒì¼ì— ìˆë˜ html ë³µì‚¬í•´ì˜¬ ìˆ˜ ìˆìŒ -->
    <!-- ë³€ìˆ˜ë„ ë„£ê¸° ê°€ëŠ¥ -->
    <%- include('nav.ejs') %>

        <input class="search">
        <button class="search-send">ê²€ìƒ‰</button>
        <script>
            document.querySelector('.search-send').addEventListener('click', function () {
                let ì…ë ¥í•œê±° = document.querySelector('.search').value;
                //query stringë¡œ ì „ì†¡
                location.href = '/search?val=' + ì…ë ¥í•œê±°;
            })
        </script>

        <div class="white-bg">
            <%for(let i=0;i<ê¸€ëª©ë¡.length;i++){%>
                <div class="list-box">
                    <h4>
                        <a href="/detail/<%=ê¸€ëª©ë¡[i]._id%>">
                            <%=ê¸€ëª©ë¡[i].title%>
                        </a>
                        <!-- ìˆ˜ì • ë° ì‚­ì œ ë²„íŠ¼ ê°ì‹¸ëŠ” ë¶€ë¶„ -->
                        <% if (user && user._id && ê¸€ëª©ë¡[i].user && user._id.toString()===ê¸€ëª©ë¡[i].user.toString()) { %>
                            <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                            <!-- ë°ì´í„° ìˆ¨ê²¨ë†“ëŠ” ë²•=>ì‰½ê²Œ êº¼ë‚´ì“°ê¸° ê°€ëŠ¥ -->
                            <span class="delete" data-id="<%=ê¸€ëª©ë¡[i]._id%>">ğŸ—‘ï¸</span>
                            <% } %>
                    </h4>
                    <p>
                        <%=ê¸€ëª©ë¡[i].content%>
                    </p>
                </div>
                <%}%>
        </div>

        <%- include('pagination.ejs') %>

            <!-- <nav aria-label="Page navigation example">
        <ul class="pagination">
            <% let totalPages=0; %>
                <% let currentPage=0; %>
                    <% if (typeof totalPages !=='undefined' ) { %>
                        <% for (let i=1; i <=totalPages; i++) { %>
                            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                <a class="page-link" href="/list/<%= i %>">
                                    <%= i %>
                                </a>
                            </li>
                            <% } %>
                                <% } %>
        </ul>
    </nav> -->


            <!-- <nav aria-label="Page navigation example">
        <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav> -->

            <!-- <a href="/list/next/<%=ê¸€ëª©ë¡[ê¸€ëª©ë¡.length-1]._id%>">ë‹¤ìŒ</a> -->




            <!-- axios -->
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script>
                //* AJAXë¡œ ì‚­ì œê¸°ëŠ¥ ë§Œë“¤ê¸° =>ìƒˆë¡œê³ ì¹¨ì—†ì´ GET ìš”ì²­í•´ì¤Œ
                //1.ì‚­ì œë²„íŠ¼ ëˆ„ë¥´ë©´ ajaxì¨ì„œ ì„œë²„ë¡œ ìš”ì²­
                // document.querySelectorAll('.delete')[0]
                //     .addEventListener('click', function () {
                //         //ì„œë²„ì— ì‚­ì œ ìš”ì²­ ë‚ ë¦¬ê¸°
                //         fetch('/abc', {
                //             method: 'POST',
                //             headers: {
                //                 'Content-Type': 'application/json'
                //             },
                //             // array, object ë¥¼ ê·¸ëƒ¥ ë„£ìœ¼ë©´ ê¹¨ì§€ê¸° ë•Œë¬¸ì— JSON.stringify() ë¥¼ ì¨ì„œ ë¬¸ìí˜•íƒœë¡œ (JSONí˜•íƒœë¡œ) ë°”ê¿”ì„œ ì „ì†¡
                //             body: JSON.stringify({ a: 1 })
                //         })
                //     })

                //ì„œë²„ë¡œ ë‚´ì´ë¦„ ì „ì†¡      
                // document.querySelectorAll('.delete')[1]
                //     .addEventListener('click', function () {
                //         //URL parameter ë°©ë²•
                //         //fetch('/abc/ë°©ìˆ˜ì—°')

                //         //query strung ë°©ë²• :fetch('/abc?ë°ì´í„°ì´ë¦„=ë°ì´í„°ê°’&ë°ì´í„°ì´ë¦„2=ë°ì´í„°ê°’2') 
                //         fetch('/abc?age=20') 
                //     })

                // axios.get('/URL').then((r) => {
                //     console.log(r)

                // }).catch(() => {
                //     //ì—ëŸ¬ì‹œ ì‹¤í–‰í•  ì½”ë“œ
                // })

                //ì²« ê¸€ì˜ ì‚­ì œë²„íŠ¼ ê¸°ëŠ¥(ë²„íŠ¼ ëˆ„ë¥´ë©´ ì„œë²„ë¡œ ìš”ì²­)
                // console.log('<%=ê¸€ëª©ë¡[0]._id%>');
                for (let i = 0; i < '<%=ê¸€ëª©ë¡.length%>'; i++) {
                    document.querySelectorAll('.delete')[i]
                        .addEventListener('click', function (e) {
                            // fetch('/delete?docid=' + '<%=ê¸€ëª©ë¡[0]._id%>', {
                            fetch('/delete?docid=' + e.target.dataset.id, {
                                method: 'DELETE'
                            })
                                //ajaxì‚¬ìš©ì‹œ ì„œë²„ê°€ ë³´ë‚¸ ë°ì´í„°ë„ ì¶œë ¥ê°€ëŠ¥
                                .then((r) => r.text())//array.obj =>.json()
                                .then((r) => {
                                    e.target.parentElement.parentElement.style.display = 'none'
                                })
                        })
                }

                //ajax ì‹¤íŒ¨í•˜ëŠ” ê²½ìš° (ì˜ˆì™¸ì²˜ë¦¬ ì»¤ë²„)
                // fetch('/URL')
                //     .then((r) => {
                //         if (r.status == 400) {
                //             return r.json()
                //         } else {
                //             //ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œì „ì†¡ì‹œ ì‹¤í–‰í• ì½”ë“œ
                //             alert('ì—ëŸ¬ë‚¨')
                //         }
                //     })
                //     .then((result) => {
                //         //ì„±ê³µì‹œ ì‹¤í–‰í• ì½”ë“œ
                //     }).catch((error) => {
                //         //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í• ì½”ë“œ
                //         console.log(error)
                //     })
                //==>ì½”ë“œê°€ ë§¤ìš° ê¸´ í¸ì´ë¼ ë¶ˆí¸í•œë° ê·¸ë˜ì„œ AJAX ë§ì´ ì“°ë©´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜í•´ì„œ ì“¸ ìˆ˜ ìˆìŒ (axios)

                //êµ¬ê¸€: 'axios cdn' ê²€ìƒ‰
                //ì°¾ì•„ì˜¨ ê±° ìƒë‹¨ì— ì¶”ê°€
            </script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
                crossorigin="anonymous"></script>
</body>

</html>